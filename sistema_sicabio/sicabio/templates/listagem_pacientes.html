{% load static %}
<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Listar Pacientes</title>

<link href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
          integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/listar.css' %}">
     <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
    <script src="http://digitalbush.com/files/jquery/maskedinput/rc3/jquery.maskedinput.js"
            type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
 <link href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.4.1/css/simple-line-icons.min.css"
          rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.linearicons.com/free/1.0.0/icon-font.min.css">
<script
  src="https://code.jquery.com/jquery-3.6.0.js"
  integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
  crossorigin="anonymous"></script>
<link href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css">
<link href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap5.min.css">

</head>
<style>

     #table_p tbody tr:hover td {
        background: none repeat scroll 0 0 #dedee0;
    }
.pull-left{
    float: left !important;
}

    .centered {
    margin: 0 auto !important;
    float: none !important;
}

    body {
        background: whitesmoke;
    }
.dataTables_filter {
   float: right !important;
}
@media
only screen and (max-width: 760px),
(min-device-width: 768px) and (max-device-width: 1024px) {

    /* Force table to not be like tables anymore */
    table, thead, tbody, th, td, tr {
        display: block;
    }

    /* Hide table headers (but not display: none;, for accessibility) */
    thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
    }

    tr {
        border: 1px solid #ccc;
    }

    td {
        /* Behave  like a "row" */
        border: none;
        position: relative;
        padding-left: 50%;
    }

    td:before {
        /* Now like a table header */
        position: absolute;
        /* Top/left values mimic padding */
        top: 6px;
        left: 6px;
        width: 45%;
        padding-right: 10px;
    }
}
</style>
{% include "navbar.html" %}
<body>

<div id="main" class="container-fluid m-2">

    <div id="top" class="row">
        <div class="col-sm-3  mt-3" >
            <button class="btn btn-primary" type="button"
                    id='CadPaciente' data-target="#myModal" data-toggle="modal"
                    data-url="{% url 'create-paciente' %}">Cadastrar Paciente
            </button>
        </div>


    </div>


    <hr/>
    <div id="list" class="row">

        <div class="table-responsive m-3" >
            {% if messages %}

                {% for message in messages %}
                    <div class="container-fluid p-0 ">
                        <div class="alert {{ message.tags }} alert-dismissible" role="alert">
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            {{ message }}
                        </div>
                    </div>
                {% endfor %}

            {% endif %}
            <table id="table_p" class="table table-striped table-bordered ui celled table mb-2"
            >
            {% include 'includes/partial_paciente_list.html' %}
            </table>
        </div>
</div>
<!-- /#list -->

<div class="container">
<div class="col-sm-6 centered">

{% if paciente.paginator.num_pages > 1 %}
<nav aria-label="Navegação de página exemplo">
	<ul class="pagination justify-content-center">
		{% if paciente.has_previous %}
		<li class="page-item"><a class="page-link" href="?page=1"> Primeira</a></li>
		{% else %}
		<li class="page-item"><a class="page-link" href="#"> Primeira</a></li>
		{% endif %}
		{% if paciente.has_previous %}
		<li class="page-item"><a class="page-link" href="?page={{ paciente.previous_page_number }}">Anterior</a></li>
		{% else %}
		<li class="page-item"><a class="page-link" href="#">Anterior</a></li>
		{% endif %}
		{% if paciente.has_next %}
		<li class="page-item"><a class="page-link" href="?page={{ paciente.next_page_number }}">Próximo</a></li>
		{% else %}
		<li class="page-item"><a class="page-link" href="#">Próximo</a></li>
		{% endif %}
		{% if paciente.has_next %}
		<li class="page-item"><a class="page-link" href="?page={{ paciente.paginator.num_pages }}">Última</a></li>
		{% else %}
		<li class="page-item"><a class="page-link" href="#">Última </a></li>
		{% endif %}
	</ul>
</nav>


{% endif %}
</div>
</div>


<!-- /#main -->
<div class="modal fade" id="myModal"  data-backdrop='false'tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

        </div>
    </div>
</div>


</div>
</body>

</html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>




<script  type="text/javascript">


  $(function () {
    $('.dropdown-toggle').dropdown();
  });


$(document).ready(function() {
    $('#table_p').DataTable({
         "paging":   false,
        "ordering": true,
        "info":     false,
        "order": [[ 1, "desc" ]],
          "dom": '<"top"f>lt<"bottom"><"clear">',
         language: {
        searchPlaceholder: "Pesquisar",
            search: "_INPUT_",
    }


    });
} );
$(function () {

            /* Functions */

            var loadForm = function () {
                var btn = $(this);
                $.ajax({
                    url: btn.attr("data-url"),
                    type: 'get',
                    dataType: 'json',
                    beforeSend: function () {

                    },
                    success: function (data) {
                        $("#myModal .modal-content").html(data.html_form);


                    }
                });
            };


            var saveForm = function () {
                var form = $(this);
                $.ajax({
                    url: form.attr("action"),
                    data: form.serialize(),
                    type: form.attr("method"),
                    dataType: 'json',
                    success: function (data) {
                        if (data.form_is_valid) {
                            $("#table_p tbody").html(data.html_paciente_list)
                            alert('Dados Salvos!');
                           $("#myModal").modal('hide');





                        } else {
                            alert('Erro no cadastro!')
                            $("#myModal .modal-content").html(data.html_form);
                        }
                    }
                });
                return false;
            };





            // create Paciente
            $("#CadPaciente").click(loadForm);
            $("#myModal").on("submit", ".js-paciente-create-form", saveForm);


            //// Update Paciente
            $("#table_p").on("click", ".js-update-paciente", loadForm);
            $("#myModal").on("submit", ".js-paciente-update-form", saveForm);
        });




    </script>
