{% load static %}
<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Listar Pacientes</title>


    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
          integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/listar.css' %}">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
    <script src="http://digitalbush.com/files/jquery/maskedinput/rc3/jquery.maskedinput.js"
            type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

</head>
<style>
    .centered {
    margin: 0 auto !important;
    float: none !important;
}

    body {
        background: whitesmoke;
    }

</style>
{% include "navbar.html" %}
<body>

<div id="main" class="container-fluid">

    <div id="top" class="row">
        <div class="col-sm-3  mt-3" >
            <button class="btn btn-primary" type="button"
                    id='CadPaciente' data-target="#myModal" data-toggle="modal"
                    data-url="{% url 'create-paciente' %}">Cadastrar Paciente
            </button>
        </div>


    </div>


    <hr/>
    <div id="list" class="row">

        <div class="table-responsive col-md-12">
            {% if messages %}

                {% for message in messages %}
                    <div class="container-fluid p-0">
                        <div class="alert {{ message.tags }} alert-dismissible" role="alert">
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            {{ message }}
                        </div>
                    </div>
                {% endfor %}

            {% endif %}
            <table id="table_p" class="table table-striped">
                {% include 'includes/partial_paciente_list.html' %}
            </table>
        </div>
</div>
<!-- /#list -->

<div class="container">
<div class="col-sm-6 centered">

{% if paciente.paginator.num_pages > 1 %}
<nav aria-label="Navegação de página exemplo">
	<ul class="pagination justify-content-center">
		{% if paciente.has_previous %}
		<li class="page-item"><a class="page-link" href="?page=1"> Primeira</a></li>
		{% else %}
		<li class="page-item"><a class="page-link" href="#"> Primeira</a></li>
		{% endif %}
		{% if paciente.has_previous %}
		<li class="page-item"><a class="page-link" href="?page={{ paciente.previous_page_number }}">Anterior</a></li>
		{% else %}
		<li class="page-item"><a class="page-link" href="#">Anterior</a></li>
		{% endif %}
		{% if paciente.has_next %}
		<li class="page-item"><a class="page-link" href="?page={{ paciente.next_page_number }}">Próximo</a></li>
		{% else %}
		<li class="page-item"><a class="page-link" href="#">Próximo</a></li>
		{% endif %}
		{% if paciente.has_next %}
		<li class="page-item"><a class="page-link" href="?page={{ paciente.paginator.num_pages }}">Última</a></li>
		{% else %}
		<li class="page-item"><a class="page-link" href="#">Última </a></li>
		{% endif %}
	</ul>
</nav>


{% endif %}
</div>
</div>

<!-- /#main -->
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog modal-dialog-centered ">
        <div class="modal-content">

        </div>
    </div>
</div>


</div>
</body>

</html>
<script src="{% static 'js/jquery.js' %}"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>
{% block javascript %}

    <script>


  $(function () {
    $('.dropdown-toggle').dropdown();
  });

        $(function () {

            /* Functions */

            var loadForm = function () {
                var btn = $(this);
                $.ajax({
                    url: btn.attr("data-url"),
                    type: 'get',
                    dataType: 'json',
                    beforeSend: function () {

                    },
                    success: function (data) {
                        $("#myModal .modal-content").html(data.html_form);


                    }
                });
            };


            var saveForm = function () {
                var form = $(this);
                $.ajax({
                    url: form.attr("action"),
                    data: form.serialize(),
                    type: form.attr("method"),
                    dataType: 'json',
                    success: function (data) {
                        if (data.form_is_valid) {
                            $("#table_p tbody").html(data.html_paciente_list)
                            alert('Dados Salvos!');
                            $('#fo').trigger("reset");
                            $("#myModal ").modal('hide');


                        } else {
                            alert('Erro no cadastro!')
                            $("#myModal .modal-content").html(data.html_form);
                        }
                    }
                });
                return false;
            };





            // create Paciente
            $("#CadPaciente").click(loadForm);
            $("#myModal").on("submit", ".js-paciente-create-form", saveForm);


            //// Update Paciente
            $("#table_p").on("click", ".js-update-paciente", loadForm);
            $("#myModal").on("submit", ".js-paciente-update-form", saveForm);
        });




    </script>
{% endblock javascript %}